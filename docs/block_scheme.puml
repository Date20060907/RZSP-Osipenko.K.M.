@startuml
title Работа приложения "Система учёта оценок"

start

:Запуск приложения\n(App.main());
note right
  Инициализация БД через DatabaseManager
  (создание таблиц при первом запуске)
end note

:Открытие окна\n"Список групп"\n(GroupListController);

while (Пользователь работает?) is (Да)
  if (Выбрана группа?) then (Да: двойной клик)
    :Открытие окна\n"Список дисциплин"\n(SubjectListController);
    
    while (В окне дисциплин?) is (Да)
      if (Выбрана дисциплина?) then (Да: двойной клик)
        :Открытие таблицы оценок\n(AssesmentTableController);
        :Пользователь редактирует оценки;
        :Изменения сохраняются\nв реальном времени в БД;
        :Закрытие таблицы;
        break
      elseif (Нажата "Добавить") then (Да)
        :Открытие модального окна\n"Добавить дисциплину";
        if (Выбран существующий предмет?) then (Да)
          :Создание связи\n"группа ↔ предмет";
        else
          :Импорт CSV →\nсоздание нового предмета\nи занятий;
          :Создание связи;
        endif
        :Обновление списка дисциплин;
      elseif (Нажата "Импорт CSV") then (Да)
        :Импорт списка предметов\nиз CSV;
        :Создание/связывание\nс текущей группой;
        :Обновление списка;
      else (Нажата "Назад")
        break
      endif
    endwhile
    
  elseif (Нажата "Импорт CSV") then (Да)
    :Импорт групп и студентов\nиз CSV;
    :Создание групп и студентов\nв БД;
    :Обновление списка групп;
    
  elseif (Нажата кнопка удаления\nрядом с группой) then (Да)
    :Удаление группы\n(каскадное удаление\nстудентов и оценок);
    :Обновление списка;
    
  else (Закрытие приложения)
    stop
  endif
endwhile

stop

@enduml